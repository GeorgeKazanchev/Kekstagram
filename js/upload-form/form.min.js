"use strict";!function(){let e=["jpg","jpeg","png","webp"],t=document.querySelector("#success"),r=document.querySelector("#error"),o=document.querySelector("#messages"),l=document.querySelector(".img-upload__form"),a=document.querySelector("#upload-file"),s=document.querySelector(".img-upload__overlay"),c=document.querySelector(".img-upload__cancel"),d=document.querySelector(".img-upload__preview img"),n=document.querySelectorAll(".effects__preview"),i=document.querySelector(".scale__control--value"),u=document.querySelector(".effect-level"),y=document.querySelector(".effect-level__slider"),p=document.querySelector("#effect-none"),m=document.querySelector(".text__hashtags"),f=document.querySelector(".text__description"),v=()=>{let t=a.files[0],r=t.name.toLowerCase(),o=e.some(e=>r.endsWith(e));if(!o)throw new window.FileFormatError("Uploaded file has unsupported format");let l=new FileReader;l.addEventListener("load",()=>{d.src=l.result,n.forEach(e=>{e.style.backgroundImage=`url(${l.result})`})}),l.readAsDataURL(t)},g=()=>{a.value="",i.value="100%",window.scale.changeUploadImageScale(100),u.classList.add("hidden"),y.style.left=`calc(100% - ${y.offsetWidth}px / 2)`,p.checked=!0,window.effect.changeImageEffect(1),m.value="",f.value="",m.setCustomValidity(""),f.setCustomValidity("")},h=e=>e.matches(".text__hashtags")||e.matches(".text__description"),S=e=>{"Escape"===e.key&&!h(e.target)&&E()},q=()=>{try{v(),s.classList.remove("hidden"),document.body.classList.add("modal-open"),document.addEventListener("keydown",S)}catch(t){t instanceof window.FileFormatError?window.render.error(`Файл имеет некорректный формат.

          Поддерживаемые форматы: ${e.join(", ")}`):window.render.error(t.message)}},E=()=>{s.classList.add("hidden"),document.body.classList.remove("modal-open"),g(),document.removeEventListener("keydown",S)},L=()=>{document.querySelector(".success")?.remove()},$=()=>{document.querySelector(".error")?.remove()},w=()=>{document.querySelector(".img-upload__message--loading")?.remove()},b=()=>{E(),w(),window.api.loadPictures(window.gallery.update,window.gallery.showError);let e=t.content.cloneNode(!0);e.querySelector(".success__button").addEventListener("click",()=>{L()}),document.body.prepend(e)},k=()=>{E(),w(),$();let e=r.content.cloneNode(!0);e.querySelector(".error__button").addEventListener("click",()=>{$()}),document.body.prepend(e)},x=()=>{let e=o.content.cloneNode(!0);document.body.prepend(e),document.body.firstElementChild.style.zIndex=100};a.addEventListener("change",()=>{q()}),c.addEventListener("click",()=>{E()}),c.addEventListener("keydown",e=>{"Enter"===e.key&&(e.preventDefault(),E())}),l.addEventListener("submit",e=>{e.preventDefault();let t=new FormData(l);window.api.uploadPhoto(t,b,k),x()})}();
